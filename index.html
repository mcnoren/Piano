<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mobile Landscape Piano</title>
    <style>
        /* --- General Layout --- */
        body {
            margin: 0;
            padding: 0;
            background-color: #222;
            color: white;
            font-family: system-ui, -apple-system, sans-serif;
            overflow: hidden; /* Prevent scrolling */
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
            touch-action: none; /* specific for mobile to prevent gestures */
        }

        /* --- Control Panel --- */
        #controls {
            height: 15vh;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            border-bottom: 2px solid #111;
        }

        h1 {
            font-size: 1.2rem;
            margin: 0;
            margin-right: 20px;
            color: #ccc;
        }

        select {
            padding: 8px 12px;
            font-size: 1rem;
            border-radius: 5px;
            border: none;
            background: #555;
            color: white;
        }

        /* --- Piano Container --- */
        #piano {
            flex-grow: 1;
            position: relative;
            background: #111;
            display: flex;
            justify-content: center;
            padding: 0 2vw; /* Side margins */
        }

        /* --- Keys --- */
        .key {
            position: relative;
            float: left;
            cursor: pointer;
            border-radius: 0 0 5px 5px;
            box-sizing: border-box;
            user-select: none;
            transition: background-color 0.1s;
        }

        .white-key {
            width: 7vw; /* Responsive width */
            height: 100%;
            background: white;
            border: 1px solid #ccc;
            border-top: none;
            z-index: 1;
        }

        .white-key.active {
            background: #eee;
            transform: scaleY(0.98);
            transform-origin: top;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }

        .black-key {
            width: 4vw; /* Narrower than white */
            height: 60%;
            background: #000;
            position: absolute;
            z-index: 2;
            margin-left: -2vw; /* Half width to overlap */
            border-radius: 0 0 3px 3px;
        }

        .black-key.active {
            background: #333;
            transform: scaleY(0.98);
            transform-origin: top;
        }

        /* Note Labels (Optional) */
        .key-label {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: #aaa;
            font-size: 0.8rem;
            pointer-events: none;
        }
        .black-key .key-label {
            color: white;
            bottom: 5px;
        }

        /* Orientation Warning */
        #portrait-warning {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 999;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }

        @media screen and (orientation: portrait) {
            #portrait-warning { display: flex; }
        }
    </style>
</head>
<body>

    <div id="portrait-warning">
        <h2>Please rotate your device to Landscape mode ðŸ”„</h2>
    </div>

    <div id="controls">
        <h1>ðŸŽ¹ WebPiano</h1>
        <label for="mode">Sound:</label>
        <select id="mode">
            <option value="piano">Grand Piano</option>
            <option value="organ">Church Organ</option>
            <option value="synth">Retro Synth</option>
        </select>
    </div>

    <div id="piano">
        <div class="key white-key" data-note="C4"><span class="key-label">C</span></div>
        <div class="key black-key" data-note="C#4"></div>
        <div class="key white-key" data-note="D4"><span class="key-label">D</span></div>
        <div class="key black-key" data-note="D#4"></div>
        <div class="key white-key" data-note="E4"><span class="key-label">E</span></div>
        <div class="key white-key" data-note="F4"><span class="key-label">F</span></div>
        <div class="key black-key" data-note="F#4"></div>
        <div class="key white-key" data-note="G4"><span class="key-label">G</span></div>
        <div class="key black-key" data-note="G#4"></div>
        <div class="key white-key" data-note="A4"><span class="key-label">A</span></div>
        <div class="key black-key" data-note="A#4"></div>
        <div class="key white-key" data-note="B4"><span class="key-label">B</span></div>
        
        <div class="key white-key" data-note="C5"><span class="key-label">C</span></div>
    </div>

    <script>
        // --- Audio Context Setup ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const ctx = new AudioContext();
        
        // Map to store active oscillators (to stop them later)
        const activeNotes = {};

        // Frequencies for the keys
        const frequencies = {
            'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13,
            'E4': 329.63, 'F4': 349.23, 'F#4': 369.99, 'G4': 392.00,
            'G#4': 415.30, 'A4': 440.00, 'A#4': 466.16, 'B4': 493.88,
            'C5': 523.25
        };

        const modeSelector = document.getElementById('mode');

        // Unlock AudioContext on first user interaction (browser policy)
        document.body.addEventListener('touchstart', function() {
            if (ctx.state === 'suspended') {
                ctx.resume();
            }
        }, { once: true });
        document.body.addEventListener('click', function() {
            if (ctx.state === 'suspended') {
                ctx.resume();
            }
        }, { once: true });


        // --- Sound Generation ---
        function playNote(note) {
            if (activeNotes[note]) return; // Don't re-trigger if holding

            const osc = ctx.createOscillator();
            const gainNode = ctx.createGain();
            const mode = modeSelector.value;
            const now = ctx.currentTime;

            osc.frequency.value = frequencies[note];
            osc.connect(gainNode);
            gainNode.connect(ctx.destination);

            // Shape the sound based on mode
            if (mode === 'piano') {
                osc.type = 'triangle';
                // Percussive envelope: Instant attack, slow decay
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(0.6, now + 0.02);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 1.5);
            } 
            else if (mode === 'organ') {
                osc.type = 'square'; // Richer sound
                // Sustained envelope: Smooth attack, full sustain
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(0.3, now + 0.05);
            } 
            else if (mode === 'synth') {
                osc.type = 'sawtooth';
                // Electronic feel
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(0.2, now + 0.1);
            }

            osc.start(now);
            
            // For piano, we let the note die out naturally even if key is held.
            // For others, we store the reference to stop it on release.
            activeNotes[note] = { osc, gainNode, mode };

            // Visual Feedback
            const keyElement = document.querySelector(`.key[data-note="${note}"]`);
            if(keyElement) keyElement.classList.add('active');
        }

        function stopNote(note) {
            const sound = activeNotes[note];
            if (!sound) return;

            const now = ctx.currentTime;
            const { osc, gainNode, mode } = sound;

            if (mode === 'piano') {
                // Piano fades out on its own usually, but release speeds it up slightly
                gainNode.gain.cancelScheduledValues(now);
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.5);
                osc.stop(now + 0.5);
            } else {
                // Organ/Synth stop immediately on release (with tiny fade to prevent popping)
                gainNode.gain.cancelScheduledValues(now);
                gainNode.gain.setValueAtTime(gainNode.gain.value, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.1);
                osc.stop(now + 0.1);
            }

            delete activeNotes[note];

            // Visual Feedback
            const keyElement = document.querySelector(`.key[data-note="${note}"]`);
            if(keyElement) keyElement.classList.remove('active');
        }

        // --- Touch & Mouse Handling ---
        const keys = document.querySelectorAll('.key');

        // We use pointer events for unified mouse/touch handling
        // But preventing default on touchstart is better for multitouch

        keys.forEach(key => {
            const note = key.getAttribute('data-note');

            // Touch Events (Mobile)
            key.addEventListener('touchstart', (e) => {
                e.preventDefault(); // Stop scrolling/zooming
                playNote(note);
            });
            
            key.addEventListener('touchend', (e) => {
                e.preventDefault();
                stopNote(note);
            });

             // Mouse Events (Desktop)
             key.addEventListener('mousedown', (e) => {
                playNote(note);
            });
            key.addEventListener('mouseup', (e) => {
                stopNote(note);
            });
            key.addEventListener('mouseleave', (e) => {
                stopNote(note);
            });
        });
    </script>
</body>
</html>
